<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<!-- Display action buttons -->
  <div class="panel panel-info">
        <div class="btn-group pull-right">
		      	<% if can? :create, @interest_point %><%= link_to new_interest_point_path, class: 'btn-sm btn-info' do %><span class="glyphicon glyphicon-plus"></span>New Interest Point<% end %><% end %>
		        <% if can? :read, @interest_points %><%= link_to interest_points_path, class: 'btn-sm btn-default' do %><span class="glyphicon glyphicon-arrow-left"></span>Back to List<% end %><% end %>
		</div>
		 <div class="panel-heading clearfix"><h1><%= @interest_point.name %><% if @interest_point.pending %> - <b style="text-decoration: small-caps;">Pending</b><% end %></h1>
		</div>
		
		<!-- Show map & directions -->
    <div class="row">
        <div class="col-md-12">
          <div id="map" style='width: auto; height: 400px; border: 1px solid black;'></div><div id="directions"></div>
		  </div>
   </div>
   <!-- Show image carousel -->
   <div class="row">
     <%= render 'images/carousel', :locals => { interest_point: @interest_point } %>
   </div>
    <!-- Ratings Here For Now -->
    <% if current_user %>
    <div class="row">
      <div class="col-md-12">
        <p>Averate Rating: </p>
        <div id="star" class="rating"></div>
        <p>Your Rating: </p>
        <div id="user_star" class="rating"></div>
      </div>
    </div>
    <% end %>
    <!-- End Ratings -->
   <div class="row">
     <!-- AddThis Button BEGIN -->
     <div class="addthis_toolbox addthis_default_style col-xs-12">
       <a class="addthis_button_preferred_1"></a>
       <a class="addthis_button_preferred_2"></a>
       <a class="addthis_button_preferred_3"></a>
       <a class="addthis_button_preferred_4"></a>
       <a class="addthis_button_compact"></a>
       <a class="addthis_counter addthis_bubble_style"></a>
     </div>
     <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
     <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5316251b0fc4579f"></script>
     <!-- AddThis Button END -->
   </div>

    
   <div class="row">
      <div class="col-md-12">
        
        <table class="table table-collapse">
            <tbody>
                <tr>
                    <td><strong>Location: </strong></td><td><%= @interest_point.latitude %>&deg; N, <%= @interest_point.longitude %>&deg; W</td>
                </tr>
                <tr>
                    <td><strong>Address: </strong></td><td><%= @interest_point.full_address %></td>
                </tr>
                <tr>
                    <td><strong>Category:  </strong></td><td><%= link_to @interest_point.category.name, @interest_point.category %></p></td>
                </tr>
                <tr>
                    <td><strong>Summary:</strong></td><td><%= @interest_point.summary %></td>
                </tr>
                <tr>
                    <td><strong>Created By:  </strong></td><td><%= @interest_point.contributor.first_name %> <%= @interest_point.contributor.last_name %></td>
                </tr>
                <tr>
                    <td><strong>Created On:  </strong></td><td><%= format_datetime(@interest_point.created_at) %></td>
                </tr>
                <tr>
                	<td><strong>Approved By:  </strong></td><td><% unless @interest_point.approver.nil? %><%= @interest_point.approver.first_name %> <%= @interest_point.approver.last_name %><% end %></td>
                </tr>
                <tr>
                	<td><strong>Approved On: </strong></td><td><% unless @interest_point.approved_at.nil? %><%= format_datetime(@interest_point.approved_at) %><% end %></td>
                </tr>
                <tr>
                    <td colspan='2'>
                    	<% if can? :update, @interest_point %><%= link_to 'Edit', edit_interest_point_path(@interest_point), class: "btn btn-success", 'data-no-turbolink' => true %><% end %>
                    	<% if can? :delete, @interest_point %><%= link_to 'Delete', interest_point_path(@interest_point), method: :delete, data: { confirm: "Are you sure you want to delete this Interest Point?" }, class: 'btn btn-danger' %><% end %>
                    	
                    </td>
                </tr>
            </tbody>
        </table>
      </div>
    </div>
    <script type="text/javascript">
        handler = Gmaps.build('Google');
		handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
  		    markers = handler.addMarkers(<%=raw @hash.to_json %>);
  		    handler.bounds.extendWith(markers);
  		    handler.fitMapToBounds();
        });
		/* new */
		var directionsService = new google.maps.DirectionsService();
		var directionsRenderer = new google.maps.DirectionsRenderer();
  		directionsRenderer.setMap(handler.getMap());
		directionsRenderer.setPanel(document.getElementById('directions'));
  
		var destination = "Carrollton, Ga";
		function route(position) {
    		var request = {
					origin: position.coords.latitude + "," + position.coords.longitude,
  					destination: destination,
	  				travelMode: google.maps.DirectionsTravelMode.DRIVING
			};
	
			directionsService.route(request, function(result, status) {
				if (status == google.maps.DirectionsStatus.OK) {
					directionsRenderer.setDirections(result);
				}
			});
		}

		function showLocation(position) {
  			var latitude = position.coords.latitude;
  			var longitude = position.coords.longitude;
  			alert("Latitude : " + latitude + " Longitude: " + longitude);
		}

		function errorHandler(err) {
  			if(err.code == 1) {
    			alert("Error: Access is denied!");
  			}else if( err.code == 2) {
    			alert("Error: Position is unavailable!");
  			}
		}
		function getLocation(lat, lng){
   	    	if(navigator.geolocation){
    	    	// timeout at 60000 milliseconds (60 seconds)
    		    var options = {timeout:60000};
    		    destination = "" + lat + "," + lng;
    		    navigator.geolocation.getCurrentPosition(route,
                                               errorHandler,
                                               options);
   		    }else{
    		    alert("Sorry, browser does not support geolocation!");
   		    }
		}

	</script>
    <div class="row">
        <div class="col-md-12">
            <% if can? :read, Comment && !@interest_point.pending %><%= render partial: "shared/comments", locals: {commentable: @interest_point} %><% end %>
        </div>
    </div>
    <% if current_user %>
    <script>
        $('#star').raty({
            readOnly: true,
            score: <%= @interest_point.average_rating %>,
            path: '/assets'
        });
        $('#user_star').raty({
            score: <%= @interest_point_rating.score %>,
            path: '/assets',
            click: function(score, evt) {
                $.ajax({
                    url: '/interest_point_ratings/' + <%= @interest_point_rating.id %>,
                    type: 'PATCH',
                    data: { score: score }
                });
            }
        });
    </script>
    <% end %>
  </div>